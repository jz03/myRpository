## 1.定义

mybatis是一个持久性框架，半自动化ORM（对象关系映射）框架，避免了几乎所有的jdbc代码和手动设置参数和结果集。支持定制化的sql、存储过程和高级映射。通过简单的xml配置和注解完成接着操作。

## 1.1. ORM

对象关系映射，关系数据库表的字段与对象属性存在一种映射关系。在程序中通过这种关系将数据持久化到关系数据库中。

### 1.2. 半自动

Hibernate就是全自动映射工具，根据对象关系模型直接获取。mybatis则需要自己来编写SQL，查询关联对象对应关系都需要手工设置。

### 1.3.适用场景

- 专注于SQL本身，灵活
- 对性能要求高，需求变化较多

## 2.JDBC存在的问题与解决

- 频繁的创建连接，释放，造成资源的浪费，使用连接池需要自己来实现。

直接在配置中设置连接池

- SQL定义的部分存在硬编码，实际工作中都存在着很大的变动

SQL配置文件和java代码分离

- 处理结果集的部分存在一些代码重复

执行SQL结果集直接映射到java对象中

## 3.Hibernate 和 MyBatis 的区别

- 相同之处：都是对jdbc的封装，是持久化框架，dao层开发

- 不同之处

①映射关系

- MyBatis 是一个半自动映射的框架，配置Java对象与sql语句执行结果的对应关系，多表关联关系配置简单
- Hibernate 是一个全表映射的框架，配置Java对象与数据库表的对应关系，多表关联关系配置复杂

②SQL优化和移植性

- Hibernate 对SQL语句封装，提供了日志、缓存、级联（级联比 MyBatis 强大）等特性，此外还提供 HQL（Hibernate Query Language）操作数据库，数据库无关性支持好，但会多消耗性能。如果项目需要支持多种数据库，代码开发量少，但SQL语句优化困难。
- MyBatis 需要手动编写 SQL，支持动态 SQL、处理列表、动态生成表名、支持存储过程。开发工作量相对大些。直接使用SQL语句操作数据库，不支持数据库无关性，但sql语句优化容易。

③开发难度和学习成本

- Hibernate 是重量级框架，学习使用门槛高，适合于需求相对稳定，中小型的项目
- MyBatis 是轻量级框架，学习使用门槛低，适合于需求变化频繁，大型的项目

## 4. 工作原理

![](D:\20-workspace\myRpository\image\mybatis实现原理.png)

![](D:\20-workspace\myRpository\image\mybatis架构.png)

![](D:\20-workspace\myRpository\image\mybatis框架设计.png)

数据库的配置（连接池，事务），输入和输出（结果），SQL编写。其他的工作由框架来完成。

### 4.1 预编译

数据库驱动在送SQL语句和参数给DBMS之前，对SQL语句进行预编译，这样到DBMS执行SQL时就不需要进行编译。

预编译可以合并多次操作为一个操作，也可以对象可以重复使用，预编译可以缓存当前的PreparedState对象，当同样的SQL语句出现时可以重复使用。



