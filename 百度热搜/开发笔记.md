# 百度热搜

## 0.想法

获取当前的热搜信息，存下来下，可以把历史上的热搜进行分析对比，找出自己需要的信息，达到能够预测未来热搜的趋势。

可以对当前热搜内容进行归类分析。

可以获取一条信息热度曲线，分析出相关联的信息，找出主要的信息点。

手工整理其中有关联的信息，找出其中的脉络

每天新增信息个数，变化有多大，关键词，主题是哪些
一周之内的新增个数，关键词，主题都有哪些，反应哪些问题

### 部署到虚拟机服务器上

挂载我的配置文件
使用docker中的mysql
实现jar包和配置可以挂载

配置文件挂载出来
程序包挂载出来
设置启动脚本
**日志需要打印到文件中**

## 1.需求

- [100%] 热搜的前30位
- [100%] 定时任务：每隔一个小时抓取一次
- [100%] 抓取的信息存放在数据库中
- [100%] 能够实现在桌面直接启动
- [20%] 需要编写前端页面，方便查看信息和操作
	- [100%] 热搜信息查询（可以查询到新增的热搜信息）
		功能定位：查询到所有的登上热搜的信息
		关键词：findHotInfoList
		输入：搜索关键词
		输出：id、查询关键词、详细描述、日期
- [100%] 热搜历史查询（查询某一消息的历史排名、热度等信息）
		加上对应的统计曲线图		
		功能定位：用来查询某一条信息的热搜历史
		关键词：findHotInfoHistoryList
		输入：搜索关键词、id（用来精确查询）
		输出：批次号、排名、热搜指数、查询关键词、批次日期
	- [0%] 统计某一消息的热度趋势折线图,查询出多个消息时，展示为多条曲线
- [0%] 统计每天的个数，显示为折线图，点击折线图上的某一天，显示这一天的全部信息
	- [0%]可以对某一个信息进行评价说明


### 1.1.关键字

- baidu-hot-search
- baiduHotSearch

- HotSearchInfo
- hot_search_info

- hot_branch
- hot_info

## 2.进度

- [100%] [功能实现] 实现了数据的解析
- [100%] [功能实现] 将解析的数据可以插入数据库
- [100%] [功能实现] 实现定时任务
- [70%] 创建启动程序的快捷方式（完成了启动，但是显示不够友好）  
- [20%] 需要了解cmd脚本命令
- [100%] [实现改进] 需要改进数据库表结构，需要把hot_search_info拆为两张表，防止数据大量的重复
	获取到的热点信息入库的业务逻辑
	每次添加入库的时候，hot_branch都要添加
	添加的时候需要判断hot_info中是否有相应的信息，如果没有则进行添加，如果存在，需要做一下对比，是否有信息更新。
	首先更新插入hot_info(上热搜的信息)表，然后是hot_branch（每次抓取的信息）表的操作
- [100%] [功能实现]热搜信息查询（可以查询到新增的热搜信息）
	- [100%] [功能优化]在“查询关键词”上添加超级链接，方便直接点击查看详情
- [100%] [功能实现] 信息历史

## 3.关键技术

### 3.1.环境
- 基于jdk1.8
- 数据库mysql5.7.34

### 3.2.框架
- 工程管理 maven
- spring-boot
- 数据库访问 mybatis
- 解析html文件 jsoup
- 前端框架 bootstrap  vue

### 3.3.请求分析工具
- http接口访问 postman

## 4.问题

### 4.1.数据库表编码

创建表和字段的时候没有注意编码和字符集，否则在写入数据库的时候就会出现编码问题
将编码和字符集都设置为utf-8，字符集设置为utf8_general_ci
同时在连接url中也进行编码的设置

### 4.2.一张hot_search_info表出现的问题

- 出现了大量的重复信息
- 无法获取到哪些是新增的，哪些退出热搜的，哪些是上升的，哪些是下降的，哪些是高光时刻

### 4.2.日期格式转换为字符串

在web返回时，日期格式转换为json字符串会出现问题，日期一直返回为空，经过分析，原来是变量名拼错，
此时能够返回对应的值，但是，返回的字符串一直是空，原本以为是字符串转换的问题，一直在网上查找
各种转换的方法，但都是返回是空，一直怀疑是java代码的错误，昨天最终没有解决这个问题，第二天一早，
就发现前端也出现了类似的拼写错误，所以一直是空，后来又改为昨天日期转换为字符串的方法，发现都是
有效的。
由于不知道其中的原理，就开始盲目的猜测其中的错误，而没能快速的定位到代码错误的地方。

### 4.3. vue中v-html方法不能够动态转换为html内容

刚开始试着用v-html来实现表格动态内容展示，经过一番尝试，原本想着是ajax异步的原因，于是就试了一下同步
依旧是解决不了，后来使用的jq中的方式，很快解决了这个问题。

### 4.4. 如何清除页面输入框的缓存

```html
autocomplete="off"
```

### 4.5. 科学计数法问题

在查询SQL上添加了concat函数。
concat(a.branch_id)

### 4.6.服务器上的时间问题

宿主机的时间和时区的错误，会影响到容器中的时区
需要在容器中添加容器环境变量TZ=Asia/Shanghai

```shell
# 下载时间校准软件
yum -y install ntp
#通过阿里云时间服务器校准时间
ntpdate ntp1.aliyun.com
```

### 4.7.docker部署命令

```shell
docker run -d -v /home/baidu_search_data/appconf:/root/appconf -v /home/baidu_search_data/appdata:/root/appdata -p 8080:8080 --name baidu_search1.2 ed7da066108e
```









