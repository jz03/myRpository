## 1.原理

- 1.7

Segment + HashEntry + Unsafe

分段（segment）式锁

- 1.8

移除Segment，使锁的粒度更小，Synchronized + CAS + Node + Unsafe

## 2. 1.8版本的扩容

sizeCtl是用来控制容器是否来扩容

-1：代表容器还没有初始化，需要进行初始化操作

-N：代表有N-1个线程正在进行扩容操作

## 3. 1.7和1.8的区别

### 3.1.put操作

- 1.7：先定位Segment，再定位桶，put全程加锁，get时候不加锁，没有获取锁的线程提前找桶的位置，并最多自旋64次获取锁，超过则挂起。
- 1.8：由于移除了Segment，类似HashMap，可以直接定位到桶，拿到first节点后进行判断，
1、 为空则CAS插入；
2、为-1则说明在扩容，则跟着一起扩容；
3、else则加锁put（类似1.7）

尽量减少对同步锁的使用，这样可以提高性能。之间的差别主要体现在put操作上。get操作基本相似。



