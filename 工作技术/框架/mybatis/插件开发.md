plugin插件开发，基本原理是基于java的动态代理来实现的。

### 1.开发步骤

① 创建插件实现类，在注解上说明是哪一个handler的插件

```java
@Intercepts({
        @Signature(type = StatementHandler.class,
                method = "parameterize",
                args = java.sql.Statement.class)
})
public class MyPlugin implements Interceptor {

    /**
     * 拦截对象，动态代理使用的业务类
     * @param invocation
     * @return
     * @throws Throwable
     */
    @Override
    public Object intercept(Invocation invocation) throws Throwable {
        System.out.println("执行拦截处理*********"+invocation);
        return invocation.proceed();
    }

    /**
     * 包装目标对象
     * @param target
     * @return
     */
    @Override
    public Object plugin(Object target) {
        System.out.println("包装目标对象*********"+target.getClass().getName());
        //也就是动态代理
        Object wrap = Plugin.wrap(target, this);
        return wrap;
    }

    /**
     * 接收配置中的变量属性
     * @param properties
     */
    @Override
    public void setProperties(Properties properties) {
        String someProperty = properties.getProperty("someProperty");
        System.out.println(someProperty);
    }
}
```

② 配置

```xml
<!-- mybatis-config.xml -->
<plugins>
  <plugin interceptor="org.example.plugin.MyPlugin">
    <property name="someProperty" value="100"/>
  </plugin>
</plugins>
```

### 2.使用对象

- Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)
- ParameterHandler (getParameterObject, setParameters)
- ResultSetHandler (handleResultSets, handleOutputParameters)
- StatementHandler (prepare, parameterize, batch, update, query)